<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>高可用业务集群实验 | Sevge&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="">
    <meta name="description" content="准备工作老惯例，SELINX和IPTABLES先清一下12setenforce 0service firewalld stop 配置最外层的防火墙（路由） 先在虚拟机上添加一块网卡，采用桥接模式 复制/etc/sysconfig/network-script/ifcfg-ens33一份到/etc/sysconfig/network-script/ifcfg-ens37 记得修改其中的内容为ens3">
<meta property="og:type" content="article">
<meta property="og:title" content="高可用业务集群实验">
<meta property="og:url" content="https://sevge.github.io/about/2018/09/11/linux-enterprise-cluster/index.html">
<meta property="og:site_name" content="Sevge&#39;s Blog">
<meta property="og:description" content="准备工作老惯例，SELINX和IPTABLES先清一下12setenforce 0service firewalld stop 配置最外层的防火墙（路由） 先在虚拟机上添加一块网卡，采用桥接模式 复制/etc/sysconfig/network-script/ifcfg-ens33一份到/etc/sysconfig/network-script/ifcfg-ens37 记得修改其中的内容为ens3">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://imglf3.nosdn0.126.net/img/c09lVS9TR3YrUFoyU01OdGZmc2E3MkN2YkFkWVBHT2VERVdDTjJuei9ka1A4RjNhZUIrYVd3PT0.png?imageView&thumbnail=500x0&quality=96&stripmeta=0">
<meta property="og:image" content="http://imglf3.nosdn0.126.net/img/c09lVS9TR3YrUFoyU01OdGZmc2E3L01jNCtBc2FsYm9WL0xFM1ozaXVEWHMyeFZOdUZCNWFRPT0.png?imageView&thumbnail=500x0&quality=96&stripmeta=0">
<meta property="og:image" content="http://imglf4.nosdn0.126.net/img/c09lVS9TR3YrUFoyU01OdGZmc2E3eEJCditvUGJZSXZPRm9MR2hrcmloeXVWZEpPWmFqQUV3PT0.png?imageView&thumbnail=500x0&quality=96&stripmeta=0">
<meta property="og:image" content="http://imglf3.nosdn0.126.net/img/c09lVS9TR3YrUFoyU01OdGZmc2E3MmdrL2J4ZGlsTEZoRzFRZExHZGRpeUViWVRaTFB2dmFRPT0.png?imageView&thumbnail=500x0&quality=96&stripmeta=0">
<meta property="og:image" content="http://imglf6.nosdn0.126.net/img/c09lVS9TR3YrUFoyU01OdGZmc2E3N1J6R3ZRdkQ0NWFEQU00SjFrRjhFdUhVOHlHc2hDODdBPT0.png?imageView&thumbnail=500x0&quality=96&stripmeta=0">
<meta property="og:image" content="http://imglf6.nosdn0.126.net/img/c09lVS9TR3YrUFoyU01OdGZmc2E3NnllTkNGTGtKTW9BWlRpWm83UXZNYlJYUFo4eVFhQklnPT0.png?imageView&thumbnail=500x0&quality=96&stripmeta=0">
<meta property="og:updated_time" content="2018-09-11T00:07:25.690Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="高可用业务集群实验">
<meta name="twitter:description" content="准备工作老惯例，SELINX和IPTABLES先清一下12setenforce 0service firewalld stop 配置最外层的防火墙（路由） 先在虚拟机上添加一块网卡，采用桥接模式 复制/etc/sysconfig/network-script/ifcfg-ens33一份到/etc/sysconfig/network-script/ifcfg-ens37 记得修改其中的内容为ens3">
<meta name="twitter:image" content="http://imglf3.nosdn0.126.net/img/c09lVS9TR3YrUFoyU01OdGZmc2E3MkN2YkFkWVBHT2VERVdDTjJuei9ka1A4RjNhZUIrYVd3PT0.png?imageView&thumbnail=500x0&quality=96&stripmeta=0">
    
        <link rel="alternate" type="application/atom+xml" title="Sevge&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Sevge</h5>
          <a href="mailto:sevge6582@gmail.com" title="sevge6582@gmail.com" class="mail">sevge6582@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-link"></i>
                关于
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">高可用业务集群实验</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">高可用业务集群实验</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-09-11T00:47:18.000Z" itemprop="datePublished" class="page-time">
  2018-09-11
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Linux/">Linux</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#准备工作"><span class="post-toc-number">1.</span> <span class="post-toc-text">准备工作</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#配置最外层的防火墙（路由）"><span class="post-toc-number">2.</span> <span class="post-toc-text">配置最外层的防火墙（路由）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#lvs-keepalived-nginx-gunicorn部署自己的django项目并实现高可用性"><span class="post-toc-number">3.</span> <span class="post-toc-text">lvs + keepalived + nginx + gunicorn部署自己的django项目并实现高可用性</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#环境"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">环境</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#搭建NFS服务"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">搭建NFS服务</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#环境-1"><span class="post-toc-number">3.2.1.</span> <span class="post-toc-text">环境</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#部署django项目"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">部署django项目</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#安装supervisor监控gunicorn和nginx服务"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">安装supervisor监控gunicorn和nginx服务</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#MysqlRouter-Mariadb实现主从而复制和读写分离"><span class="post-toc-number">4.</span> <span class="post-toc-text">MysqlRouter+Mariadb实现主从而复制和读写分离</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#192-168-177-9-Master"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">192.168.177.9:Master</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#192-168-177-10-Slave"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">192.168.177.10:Slave</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#192-168-177-11：Backup"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">192.168.177.11：Backup</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#192-168-177-8：Router"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">192.168.177.8：Router</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#此时可以测试"><span class="post-toc-number">4.4.1.</span> <span class="post-toc-text">此时可以测试</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用Docker容器的Nginx代理两个域名"><span class="post-toc-number">5.</span> <span class="post-toc-text">使用Docker容器的Nginx代理两个域名</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#配置和使用Ansible"><span class="post-toc-number">6.</span> <span class="post-toc-text">配置和使用Ansible</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#配置Zabbix监控所有服务器"><span class="post-toc-number">7.</span> <span class="post-toc-text">配置Zabbix监控所有服务器</span></a></li></ol>
        </nav>
    </aside>


<article id="post-linux-enterprise-cluster"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">高可用业务集群实验</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-09-11 08:47:18" datetime="2018-09-11T00:47:18.000Z"  itemprop="datePublished">2018-09-11</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Linux/">Linux</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p>老惯例，SELINX和IPTABLES先清一下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0</span><br><span class="line">service firewalld stop</span><br></pre></td></tr></table></figure></p>
<h3 id="配置最外层的防火墙（路由）"><a href="#配置最外层的防火墙（路由）" class="headerlink" title="配置最外层的防火墙（路由）"></a>配置最外层的防火墙（路由）</h3><ol>
<li>先在虚拟机上添加一块网卡，采用桥接模式</li>
<li>复制/etc/sysconfig/network-script/ifcfg-ens33一份到/etc/sysconfig/network-script/ifcfg-ens37</li>
<li>记得修改其中的内容为ens37，UUID也修改为唯一</li>
<li>配置SNAT，让内部服务器可以上网，DNAT将端口映射出去：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 安装iptables防火墙</span><br><span class="line">yum install -y iptables-services</span><br><span class="line"># 对iptables进行初始化</span><br><span class="line">iptables -F</span><br><span class="line">iptables -t nat -F</span><br><span class="line"># 打开系统的IP转发功能</span><br><span class="line">echo &quot;net.ipv4.ip_forward=1&quot; &gt;&gt; /etc/sysctl.conf </span><br><span class="line"># 不用重启,立即生效</span><br><span class="line"></span><br><span class="line"># 配置iptables的NAT转发（重点）</span><br><span class="line">iptables -t nat -A POSTROUTING -s 192.168.177.0/24 -j SNAT --to 192.168.0.177</span><br><span class="line">iptables -t nat -A PREROUTING -d 192.168.0.177 -p tcp --dport 22 -j DNAT --to 192.168.177.2</span><br><span class="line">iptables -t nat -A PREROUTING -d 192.168.0.177 -p tcp --dport 80 -j DNAT --to 192.168.177.101</span><br><span class="line">iptables -t nat -A PREROUTING -d 192.168.0.177 -p tcp --dport 3306 -j DNAT --to 192.168.177.102</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"># 保存并启动</span><br><span class="line">iptables-save &gt; /etc/sysconfig/iptables</span><br><span class="line">systemctl start iptables</span><br><span class="line">systemctl enable iptables</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="lvs-keepalived-nginx-gunicorn部署自己的django项目并实现高可用性"><a href="#lvs-keepalived-nginx-gunicorn部署自己的django项目并实现高可用性" class="headerlink" title="lvs + keepalived + nginx + gunicorn部署自己的django项目并实现高可用性"></a>lvs + keepalived + nginx + gunicorn部署自己的django项目并实现高可用性</h3><h4 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h4><ul>
<li>LoadBalancer master：192.168.177.3</li>
<li>LoadBalancer backup：192.168.177.4</li>
<li>Web1：192.168.177.5</li>
<li>Web2：192.168.177.6</li>
<li>NFS：192.168.177.7</li>
<li><p>vip：192.168.177.101</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/network-script/ifcfg-ens33</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.177.3</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.177.1</span><br><span class="line">DNS1=119.29.29.29</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置两台Director节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">yum install -y ipvsadm keepalived</span><br><span class="line">echo 1 &gt; /proc/sys/net/ipv4/ip_forward # 开启路由转发</span><br><span class="line">ifconfig ens33 down</span><br><span class="line">ifconfig ens33 192.168.177.101 broadcast 192.168.177.101 netmask 255.255.255.255 up</span><br><span class="line">route add -host 192.168.177.101 dev ens33</span><br><span class="line">ipvsadm -C</span><br><span class="line">ipvsadm -A -t 192.168.177.101:80 -s wrr</span><br><span class="line">ipvsadm -a -t 192.168.177.101 -r 192.168.177.5:80 -g -w 3</span><br><span class="line">ipvsadm -a -t 192.168.177.101 -r 1 92.168.166.6 -g -w 3</span><br><span class="line">====</span><br><span class="line">/etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     acassen@firewall.loc</span><br><span class="line">     failover@firewall.loc</span><br><span class="line">     sysadmin@firewall.loc</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from Alexandre.Cassen@firewall.loc</span><br><span class="line">   smtp_server 192.168.200.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id LVS_DEVEL</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   # vrrp_strict</span><br><span class="line">   vrrp_garp_interval 0</span><br><span class="line">   vrrp_gna_interval 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">   state MASTER</span><br><span class="line">    interface ens33</span><br><span class="line">    virtual_router_id 17</span><br><span class="line">    priority 110</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 123123</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.177.101</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_server 192.168.177.101 80 &#123;　　#设置虚拟服务器，需要指定虚拟ip和服务端口</span><br><span class="line">    delay_loop 3　　　　#健康检查时间间隔</span><br><span class="line">    lb_algo rr　　　　 #负载均衡调度算法</span><br><span class="line">    lb_kind DR　　　　#负载均衡转发规则</span><br><span class="line">    persistence_timeout 50　　　　#设置会话保持时间，对动态网页非常有用</span><br><span class="line">    protocol TCP　　　　#指定转发协议类型，有TCP和UDP两种</span><br><span class="line"></span><br><span class="line">    real_server 192.168.177.5 80 &#123;　　#配置服务器节点1，需要指定real server的真实IP地址和端口</span><br><span class="line">        weight 1　　　　#设置权重，数字越大权重越高</span><br><span class="line">    	TCP_CHECK &#123; 　　　　#realserver的状态监测设置部分单位秒</span><br><span class="line">	connect_timeout 3　　　　#超时时间</span><br><span class="line">	nb_get_retry 3　　　　　　#重试次数</span><br><span class="line">	delay_before_retry 3　　　　#重试间隔</span><br><span class="line">	 connect_port 80    　　#监测端口</span><br><span class="line">    	&#125;</span><br><span class="line">&#125;</span><br><span class="line">    real_server 192.168.177.6 80 &#123;</span><br><span class="line">   	 weight 1</span><br><span class="line">    	TCP_CHECK &#123;</span><br><span class="line">    	connect_timeout 3</span><br><span class="line">    	nb_get_retry 3</span><br><span class="line">    	delay_before_retry 3</span><br><span class="line">    	connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">serviced keepalived start</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置两台Real Server：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ifconfig lo 192.168.177.101 broadcast 192.168.177.101 netmask 255.255.255.255 up</span><br><span class="line">route add -host 192.168.177.101 lo</span><br><span class="line">echo &quot;1&quot; &gt;/proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line">echo &quot;2&quot; &gt;/proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line">echo &quot;1&quot; &gt;/proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line">echo &quot;2&quot; &gt;/proc/sys/net/ipv4/conf/all/arp_announce</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>外面访问<code>192.168.0.177</code>，当出现如下结果即成功搭建好了lvs+nginx的高可用web服务。<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://imglf3.nosdn0.126.net/img/c09lVS9TR3YrUFoyU01OdGZmc2E3MkN2YkFkWVBHT2VERVdDTjJuei9ka1A4RjNhZUIrYVd3PT0.png?imageView&thumbnail=500x0&quality=96&stripmeta=0" alt="nginx" title="">
                </div>
                <div class="image-caption">nginx</div>
            </figure></p>
<h4 id="搭建NFS服务"><a href="#搭建NFS服务" class="headerlink" title="搭建NFS服务"></a>搭建NFS服务</h4><h5 id="环境-1"><a href="#环境-1" class="headerlink" title="环境"></a>环境</h5><ul>
<li>NFS服务器 192.168.177.7</li>
<li>客户端（web服务器）192.168.177.5/6</li>
</ul>
<p>配置服务器192.168.177.7<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># scp /tmp/ali_research root@192.168.177.7:/NFS/django_project</span><br><span class="line">yum -y install nfs-utils rpcbind</span><br><span class="line">mkdir /NFS/django_project</span><br><span class="line">chmod 666 /NFS/django_project</span><br><span class="line">echo &apos;/NFS/djagno_peoject 192.168.177.0/24(rw,no_root_squash,no_all_squash,sync)&apos; &gt; /etc/exports</span><br><span class="line"># 配置生效</span><br><span class="line">exportfs -r</span><br><span class="line"># 启动rpcbind、nfs服务</span><br><span class="line">service rpcbind start</span><br><span class="line">service nfs start</span><br><span class="line"># 查阅NFS服务</span><br><span class="line">showmount -e localhost</span><br></pre></td></tr></table></figure></p>
<ul>
<li>客户端配置 192.168.177.5/6<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum install -y nfs-utils</span><br><span class="line">mkdir /django_project</span><br><span class="line">showmount -e 192.168.177.7</span><br><span class="line"># 挂载</span><br><span class="line">mount -t nfs</span><br><span class="line">192.168.177.7:/NFS/django_peoject /django_project proto=tcp -o nolock</span><br><span class="line"># 查看挂载结果</span><br><span class="line">df -h</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="部署django项目"><a href="#部署django项目" class="headerlink" title="部署django项目"></a>部署django项目</h4><p>安装必要组件、修改django项目settings文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">yum install python36</span><br><span class="line">python36 -m ensurepip  安装pip3软件</span><br><span class="line">pip3 install django==1.11  -i https://pypi.tuna.tsinghua.edu.cn/simple/</span><br><span class="line">pip3 install django-ckeditor Pillow  -i https://pypi.tuna.tsinghua.edu.cn/simple/</span><br><span class="line">pip3 install gunicorn</span><br><span class="line"></span><br><span class="line">vi /django_project/ali_research/ali_research/settings.py</span><br><span class="line">    DEBUG=False</span><br><span class="line">    ALLOWED_HOSTS = [&apos;*&apos;,]</span><br><span class="line">    STATIC_URL = &apos;/static/&apos;</span><br><span class="line">    #STATICFILES_DIRS = [os.path.join(BASE_DIR, &quot;static&quot;), ]</span><br><span class="line">    STATIC_ROOT = os.path.join(BASE_DIR, &apos;static&apos;)</span><br><span class="line">cd /django_project/ali_research</span><br><span class="line">gunicorn -w 4 -b 127.0.0.1:8000 -D --access-logfile=/var/log/gunicorn.log ali_research.wsgi:application</span><br><span class="line">ps aux|grep gunicorn  查看进程</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /etc/nginx/nginx.conf</span><br><span class="line">user root #用户需要改为root，否则报403</span><br><span class="line">location / &#123;</span><br><span class="line">                proxy_pass http://127.0.0.1:8000;</span><br><span class="line">                proxy_set_header Host $host;</span><br><span class="line">                proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">location /static/ &#123;</span><br><span class="line">        root /django_project/ali_research/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="安装supervisor监控gunicorn和nginx服务"><a href="#安装supervisor监控gunicorn和nginx服务" class="headerlink" title="安装supervisor监控gunicorn和nginx服务"></a>安装supervisor监控gunicorn和nginx服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># 参照https://www.cnblogs.com/gjack/p/8076419.html</span><br><span class="line">yum install wget </span><br><span class="line">wget https://bootstrap.pypa.io/get-pip.py</span><br><span class="line">python get-pip.py</span><br><span class="line">pip install supervisor</span><br><span class="line">echo_supervisord_conf &gt; /etc/supervisor.conf   # 生成 supervisor 默认配置文件</span><br><span class="line"></span><br><span class="line">vim /etc/supervisor.conf                       # 修改 supervisor 配置文件，在末尾添加进程管理：</span><br><span class="line">[program:aliapp]</span><br><span class="line">command=gunicorn -w 4 -b 127.0.0.1:8000 -D --access-logfile=/var/log/gunicorn.log ali_research.wsgi:application    ; supervisor启动命令</span><br><span class="line">directory=/django_project/ali_research                                                 ; 项目的文件夹路径</span><br><span class="line">startsecs=0                                                                             ; 启动时间</span><br><span class="line">stopwaitsecs=0                                                                          ; 终止等待时间</span><br><span class="line">autostart=True                                                                        ; 是否自动启动</span><br><span class="line">autorestart=True                                                                       ; 是否自动重启</span><br><span class="line">stdout_logfile=/var/log/supervisor_gunicorn.log                           ; log 日志</span><br><span class="line">stderr_logfile=/var/log/supervisor_gunicorn.err                           ; 错误日志</span><br><span class="line"></span><br><span class="line">[program:nginx]</span><br><span class="line">command=service nginx start</span><br><span class="line">startsecs=0</span><br><span class="line">stopwaitsecs=0</span><br><span class="line">autostart=True</span><br><span class="line">autorestart=True</span><br><span class="line">stdout_logfile=/var/log/supervisor_nginx.log</span><br><span class="line">stderr_logfile=/var/log/supervisor_nginx.err</span><br><span class="line">supervisor的基本使用命令</span><br><span class="line"></span><br><span class="line">supervisord -c supervisor.conf                             通过配置文件启动supervisor</span><br><span class="line">supervisorctl -c supervisor.conf status                    察看supervisor的状态</span><br><span class="line">supervisorctl -c supervisor.conf reload                    重新载入 配置文件</span><br><span class="line">supervisorctl -c supervisor.conf start [all]|[appname]     启动指定/所有 supervisor管理的程序进程</span><br><span class="line">supervisorctl -c supervisor.conf stop [all]|[appname]      关闭指定/所有 supervisor管理的程序进程</span><br><span class="line"></span><br><span class="line">若报错“Error: Another program is already listening on a port that one of our HTTP servers is configured to use. Shut this program down first before starting”</span><br><span class="line">解决方法：</span><br><span class="line">find / -name supervisor.sock</span><br><span class="line">unlink /name/supervisor.sock</span><br></pre></td></tr></table></figure>
<h3 id="MysqlRouter-Mariadb实现主从而复制和读写分离"><a href="#MysqlRouter-Mariadb实现主从而复制和读写分离" class="headerlink" title="MysqlRouter+Mariadb实现主从而复制和读写分离"></a>MysqlRouter+Mariadb实现主从而复制和读写分离</h3><ul>
<li>环境<ul>
<li>192.168.177.8:Mysql Router</li>
<li>192.168.177.9:Mariadb Master</li>
<li>192.168.177.10:Mariadb Slave</li>
<li>192.168.177.11:Mariadb Backup</li>
</ul>
</li>
</ul>
<p>先配置主从复制功能：</p>
<h4 id="192-168-177-9-Master"><a href="#192-168-177-9-Master" class="headerlink" title="192.168.177.9:Master"></a>192.168.177.9:Master</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">yum install -y mariadb mariadb-server</span><br><span class="line"></span><br><span class="line"># 在my.cnf添加如下内容：</span><br><span class="line">vi /etc/my.cnf</span><br><span class="line">#binary log</span><br><span class="line">server-id=1</span><br><span class="line">log-bin</span><br><span class="line"></span><br><span class="line">service mariadb restart </span><br><span class="line">mysql--&gt;</span><br><span class="line">show master status;</span><br><span class="line"># 建立授权用户</span><br><span class="line">grant replication slave on *.* to &apos;rep&apos;@&apos;192.168.177.%&apos; identified by &apos;123123&apos;;</span><br><span class="line">flush privileges;</span><br><span class="line">show grants for &apos;rep&apos;@&apos;192.168.177.%&apos;;</span><br></pre></td></tr></table></figure>
<h4 id="192-168-177-10-Slave"><a href="#192-168-177-10-Slave" class="headerlink" title="192.168.177.10:Slave"></a>192.168.177.10:Slave</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">yum install -y mariadb mariadb-server</span><br><span class="line"></span><br><span class="line"># 在my.cnf添加如下内容：</span><br><span class="line">vi /etc/my.cnf</span><br><span class="line">server-id=2</span><br><span class="line">log-bin</span><br><span class="line"></span><br><span class="line">service mariadb restart</span><br><span class="line">mysql --&gt;</span><br><span class="line">change master to </span><br><span class="line">master_host=&apos;192.168.177.9&apos;,</span><br><span class="line">master_user=&apos;rep&apos;,</span><br><span class="line">master_password=&apos;123123&apos;,</span><br><span class="line">master_port=3306,</span><br><span class="line">master_log_file=&apos;mariadb-bin.000001&apos;,</span><br><span class="line">master_log_pos=245;</span><br><span class="line"></span><br><span class="line">show slave status\G; # 注意Slave_IO_Running，Slave_SQL_Running为Yes即成功开启</span><br><span class="line">stop slave</span><br><span class="line">start slave</span><br></pre></td></tr></table></figure>
<h4 id="192-168-177-11：Backup"><a href="#192-168-177-11：Backup" class="headerlink" title="192.168.177.11：Backup"></a>192.168.177.11：Backup</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line">server-id=3</span><br><span class="line">log-bin</span><br><span class="line"></span><br><span class="line">mysql --&gt;</span><br><span class="line">change master to </span><br><span class="line">master_host=&apos;192.168.177.9&apos;,</span><br><span class="line">**master_delay=300,** # 延时5min，以防止误操作的备份</span><br><span class="line"># 需要mariadb10.3.8版本以上或Mysql</span><br><span class="line">    vi /etc/yum.repo.d/CentOS-MariaDB.repo:</span><br><span class="line">    # MariaDB 10.3 CentOS repository list - created 2018-05-26 07:55 UTC</span><br><span class="line">    # http://downloads.mariadb.org/mariadb/repositories/</span><br><span class="line">    [mariadb]</span><br><span class="line">    name = MariaDB</span><br><span class="line">    #baseurl = http://yum.mariadb.org/10.3/centos7-amd64</span><br><span class="line">    baseurl = https://mirrors.tuna.tsinghua.edu.cn/mariadb//mariadb-10.3.9/yum/rhel74-amd64/</span><br><span class="line">    yum clean all</span><br><span class="line">    yum makecache</span><br><span class="line">    yum install mariadb-sever</span><br><span class="line">master_user=&apos;rep&apos;,</span><br><span class="line">master_password=&apos;123123&apos;,</span><br><span class="line">master_port=3306,</span><br><span class="line">master_log_file=&apos;mariadb-bin.000001&apos;,</span><br><span class="line">master_log_pos=245;</span><br><span class="line"></span><br><span class="line">start slave</span><br></pre></td></tr></table></figure>
<h4 id="192-168-177-8：Router"><a href="#192-168-177-8：Router" class="headerlink" title="192.168.177.8：Router"></a>192.168.177.8：Router</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-Router/mysql-router-8.0.11-1.el7.x86_64.rpm</span><br><span class="line">rpm -ivh  mysql-router-8.0.11-1.el7.x86_64.rpm</span><br><span class="line">vi /eetc/mysqlrouter.conf</span><br><span class="line"># 添加如下内容</span><br><span class="line">[routing:read_write]</span><br><span class="line">bind_address = 192.168.177.8  #是mysql-router服务器的ip地址</span><br><span class="line">bind_port = 7001</span><br><span class="line">mode = read-write</span><br><span class="line">destinations = 192.168.177.9:3306</span><br><span class="line">max_connections = 65535</span><br><span class="line">max_connect_errors = 100</span><br><span class="line">client_connect_timeout = 9</span><br><span class="line"> </span><br><span class="line">[routing:read_only]</span><br><span class="line">bind_address = 192.168.177.8</span><br><span class="line">bind_port = 7002</span><br><span class="line">mode = read-only</span><br><span class="line">destinations = 192.168.177.10:3306</span><br><span class="line">max_connections = 65535</span><br><span class="line">max_connect_errors = 100</span><br><span class="line">client_connect_timeout = 9</span><br><span class="line"></span><br><span class="line"># BACKUP由于是备份，数据有延时，因此既不提供读也不提供写。</span><br><span class="line"></span><br><span class="line">service mysqlrouter start</span><br></pre></td></tr></table></figure>
<h5 id="此时可以测试"><a href="#此时可以测试" class="headerlink" title="此时可以测试"></a>此时可以测试</h5><ul>
<li>[root@mysql-master ~]# mysql -h 192.168.177.8 -uwong -p’123123’ -P 7001    # 写的测试</li>
<li>[root@mysql-master ~]# mysql -h 192.168.177.8 -uwong -p’123123’ -P 7002    # 读的测试</li>
<li>修改Master数据库的内容，Slave马上同步，而Backup不回立即同步。</li>
</ul>
<h3 id="使用Docker容器的Nginx代理两个域名"><a href="#使用Docker容器的Nginx代理两个域名" class="headerlink" title="使用Docker容器的Nginx代理两个域名"></a>使用Docker容器的Nginx代理两个域名</h3><ul>
<li><p>安装redis</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release</span><br><span class="line">yum install docker</span><br><span class="line">service docker start</span><br><span class="line">docker pull redis</span><br><span class="line">docker images</span><br><span class="line">docker run -d -p 6379:6379 --name redis docker.io/redis</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装三个nginx容器，其中一个用来做代理转发，另外两个充当web服务器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># https://blog.csdn.net/u011164906/article/details/73135836?locationNum=5&amp;fps=1</span><br><span class="line">docker pull nginx</span><br><span class="line">docker run -d --name web1 -p 8081:80 -v /root/docker_nginx/web1.html:/usr/share/nginx/html/index.html docker.io/nginx</span><br><span class="line">docker run -d --name web2 -v /root/docker_nginx_conf/web2.html:/usr/share/nginx/html/index.html -p 8082:80 docker.io/nginx</span><br><span class="line">docker run -d --name nginx_agent --link web1:nginxa --link web2:nginxb -v /root/docker_nginx_conf/nginx.conf:/etc/nginx/nginx.conf -p 8080:80 docker.io/nginx</span><br><span class="line">#docker的对应顺序为：真实机：容器</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>使用命令<code>docker inspect -f &#39;\{\{\.Name\}\} - \{\{range \.NetworkSettings\.Networks\}\}\{\{\.IPAddress\}\}\{\{end\}\}&#39; $(docker ps -aq)</code>可以看到各个容器名对应的IP地址：</p>
<ul>
<li>172.17.0.2:d_redis</li>
<li>172.17.0.3:web1</li>
<li>172.17.0.4:web2</li>
<li>172.17.0.5:nginx_agent</li>
</ul>
<p>接下来配置/root/docker_nginx/nginx.conf：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line">events &#123;</span><br><span class="line">  worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   # include /etc/nginx/conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">  server</span><br><span class="line">    &#123;</span><br><span class="line">      listen 80; # 在容器中监听的端口为80</span><br><span class="line">      server_name www.wangtao.com;</span><br><span class="line">      location / &#123;</span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_pass http://nginxa; # 大坑--link的名称nginxa，链接另一个容器的端口80</span><br><span class="line">            &lt;!--#root@8f63042bbc29:/# cat /etc/hosts --&gt;</span><br><span class="line">            &lt;!--127.0.0.1	localhost--&gt;</span><br><span class="line">            &lt;!--::1	localhost ip6-localhost ip6-loopback--&gt;</span><br><span class="line">            &lt;!--fe00::0	ip6-localnet--&gt;</span><br><span class="line">            &lt;!--ff00::0	ip6-mcastprefix--&gt;</span><br><span class="line">            &lt;!--ff02::1	ip6-allnodes--&gt;</span><br><span class="line">            &lt;!--ff02::2	ip6-allrouters--&gt;</span><br><span class="line">            &lt;!--172.17.0.3	nginxa eba80887d700 web1--&gt;</span><br><span class="line">            &lt;!--172.17.0.4	nginxb 247ed0475876 web2--&gt;</span><br><span class="line">            &lt;!--172.17.0.5	8f63042bbc29--&gt;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  server</span><br><span class="line">    &#123;</span><br><span class="line">      listen 80;</span><br><span class="line">      server_name www.sevge.com;</span><br><span class="line">      location / &#123;</span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_pass http://nginxb;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注意容器间的连接如下：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://imglf3.nosdn0.126.net/img/c09lVS9TR3YrUFoyU01OdGZmc2E3L01jNCtBc2FsYm9WL0xFM1ozaXVEWHMyeFZOdUZCNWFRPT0.png?imageView&thumbnail=500x0&quality=96&stripmeta=0" alt="docker容器间的连接" title="">
                </div>
                <div class="image-caption">docker容器间的连接</div>
            </figure></p>
<p>修改windows机器里的hosts文件，修改web1、web2对应的html文件，运行docker容器(docker run -d -p 8081:80 -v /root/html/web1.html:/usr/share/nginx/html/index.html –name web1 docker.io/nginx、docerk run -d -p 8082:80 -v /root/html/web2.html:/usr/share/nginx/html/index.html –name web2 docker.io/nginx、docker run -d -p 8080:80 -v /root/nginx_conf:/etc/nginx/nginx.conf –name nginx_agent docker.io/nginx），分别访问可以看到：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://imglf4.nosdn0.126.net/img/c09lVS9TR3YrUFoyU01OdGZmc2E3eEJCditvUGJZSXZPRm9MR2hrcmloeXVWZEpPWmFqQUV3PT0.png?imageView&thumbnail=500x0&quality=96&stripmeta=0" alt="web1" title="">
                </div>
                <div class="image-caption">web1</div>
            </figure><br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://imglf3.nosdn0.126.net/img/c09lVS9TR3YrUFoyU01OdGZmc2E3MmdrL2J4ZGlsTEZoRzFRZExHZGRpeUViWVRaTFB2dmFRPT0.png?imageView&thumbnail=500x0&quality=96&stripmeta=0" alt="web2" title="">
                </div>
                <div class="image-caption">web2</div>
            </figure></p>
<h3 id="配置和使用Ansible"><a href="#配置和使用Ansible" class="headerlink" title="配置和使用Ansible"></a>配置和使用Ansible</h3><ul>
<li>192.168.177.14<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release</span><br><span class="line">yum install ansible</span><br><span class="line">yum install expect</span><br><span class="line"># 所有机器配置免秘钥认证，编写expect脚本</span><br><span class="line">===</span><br><span class="line">cat for.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">for i in &#123;1..13&#125;</span><br><span class="line">do</span><br><span class="line">	expect ssh_key.sh 192.168.177.$&#123;i&#125;</span><br><span class="line">done</span><br><span class="line">===</span><br><span class="line">cat ssh_key.sh</span><br><span class="line">#!/usr/bin/expect</span><br><span class="line"></span><br><span class="line">set ip [lindex $argv 0]</span><br><span class="line"></span><br><span class="line">spawn ssh-copy-id -i /root/.ssh/id_rsa.pub root@$ip</span><br><span class="line">expect &quot;(yes/no)?&quot;</span><br><span class="line">send &quot;yes\n&quot;</span><br><span class="line">expect &quot;password:&quot;</span><br><span class="line">send &quot;123123\n&quot;</span><br><span class="line">expect eof</span><br><span class="line"></span><br><span class="line">exit</span><br><span class="line">===</span><br><span class="line"># 所有机器免秘钥认证完成，接下来配置ansible的hosts文件,在末尾添加vi /etc/ansible/hosts:</span><br><span class="line">[weblb]</span><br><span class="line">192.168.177.3</span><br><span class="line">192.168.177.4</span><br><span class="line"></span><br><span class="line">[webserver]</span><br><span class="line">192.168.177.5</span><br><span class="line">192.168.177.6</span><br><span class="line"></span><br><span class="line">[nfs]</span><br><span class="line">192.168.177.7</span><br><span class="line"></span><br><span class="line">[sshd]</span><br><span class="line">192.168.177.2</span><br><span class="line"></span><br><span class="line">[dblb]</span><br><span class="line">192.168.177.8</span><br><span class="line"></span><br><span class="line">[db]</span><br><span class="line">192.168.177.9</span><br><span class="line">192.168.177.10</span><br><span class="line">192.168.177.11</span><br><span class="line"></span><br><span class="line">[docker]</span><br><span class="line">192.168.177.12</span><br><span class="line"></span><br><span class="line">[zabbix]</span><br><span class="line">192.168.177.13</span><br><span class="line">===</span><br><span class="line"># 配置playbook并执行</span><br><span class="line">cat my_play.yaml</span><br><span class="line">- hosts: all</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">    - name: allow host</span><br><span class="line">      shell: echo sshd:192.168.177.2 &gt;&gt; /etc/hosts.allow</span><br><span class="line">    - name: allow host2</span><br><span class="line">      shell: echo sshd:192.168.177.14 &gt;&gt; /etc/hosts.allow</span><br><span class="line">    - name: deny host</span><br><span class="line">      shell: echo sshd:all &gt;&gt; /etc/hosts.deny</span><br><span class="line">- hosts: sshd</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">    - name: allow host</span><br><span class="line">      shell: echo sshd:all &gt;&gt; /etc/hosts.allow</span><br><span class="line">    </span><br><span class="line">===</span><br><span class="line">ansible-playbook my_play.yaml</span><br><span class="line"></span><br><span class="line">PLAY [all] ******************************************************************************</span><br><span class="line"></span><br><span class="line">TASK [Gathering Facts] ******************************************************************</span><br><span class="line">ok: [192.168.177.13]</span><br><span class="line">ok: [192.168.177.5]</span><br><span class="line">ok: [192.168.177.12]</span><br><span class="line">ok: [192.168.177.6]</span><br><span class="line">ok: [192.168.177.8]</span><br><span class="line">ok: [192.168.177.7]</span><br><span class="line">ok: [192.168.177.2]</span><br><span class="line">ok: [192.168.177.3]</span><br><span class="line">ok: [192.168.177.4]</span><br><span class="line">ok: [192.168.177.11]</span><br><span class="line">ok: [192.168.177.9]</span><br><span class="line">ok: [192.168.177.10]</span><br><span class="line"></span><br><span class="line">TASK [allow host] ***********************************************************************</span><br><span class="line">changed: [192.168.177.13]</span><br><span class="line">changed: [192.168.177.2]</span><br><span class="line">changed: [192.168.177.8]</span><br><span class="line">changed: [192.168.177.5]</span><br><span class="line">changed: [192.168.177.7]</span><br><span class="line">changed: [192.168.177.6]</span><br><span class="line">changed: [192.168.177.12]</span><br><span class="line">changed: [192.168.177.9]</span><br><span class="line">changed: [192.168.177.10]</span><br><span class="line">changed: [192.168.177.11]</span><br><span class="line">changed: [192.168.177.3]</span><br><span class="line">changed: [192.168.177.4]</span><br><span class="line"></span><br><span class="line">TASK [deny host] ************************************************************************</span><br><span class="line">changed: [192.168.177.8]</span><br><span class="line">changed: [192.168.177.13]</span><br><span class="line">changed: [192.168.177.7]</span><br><span class="line">changed: [192.168.177.2]</span><br><span class="line">changed: [192.168.177.5]</span><br><span class="line">changed: [192.168.177.6]</span><br><span class="line">changed: [192.168.177.12]</span><br><span class="line">changed: [192.168.177.9]</span><br><span class="line">changed: [192.168.177.10]</span><br><span class="line">changed: [192.168.177.11]</span><br><span class="line">changed: [192.168.177.3]</span><br><span class="line">changed: [192.168.177.4]</span><br><span class="line"></span><br><span class="line">PLAY RECAP ******************************************************************************</span><br><span class="line">192.168.177.10             : ok=3    changed=2    unreachable=0    failed=0   </span><br><span class="line">192.168.177.11             : ok=3    changed=2    unreachable=0    failed=0   </span><br><span class="line">192.168.177.12             : ok=3    changed=2    unreachable=0    failed=0   </span><br><span class="line">192.168.177.13             : ok=3    changed=2    unreachable=0    failed=0   </span><br><span class="line">192.168.177.2              : ok=3    changed=2    unreachable=0    failed=0   </span><br><span class="line">192.168.177.3              : ok=3    changed=2    unreachable=0    failed=0   </span><br><span class="line">192.168.177.4              : ok=3    changed=2    unreachable=0    failed=0   </span><br><span class="line">192.168.177.5              : ok=3    changed=2    unreachable=0    failed=0   </span><br><span class="line">192.168.177.6              : ok=3    changed=2    unreachable=0    failed=0   </span><br><span class="line">192.168.177.7              : ok=3    changed=2    unreachable=0    failed=0   </span><br><span class="line">192.168.177.8              : ok=3    changed=2    unreachable=0    failed=0   </span><br><span class="line">192.168.177.9              : ok=3    changed=2    unreachable=0    failed=0</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="配置Zabbix监控所有服务器"><a href="#配置Zabbix监控所有服务器" class="headerlink" title="配置Zabbix监控所有服务器"></a>配置Zabbix监控所有服务器</h3><ul>
<li><p>192.168.177.13</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/clsn/p/7885990.html</span><br><span class="line">#安装zabbix源、aliyun YUM源</span><br><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">rpm -ivh http://repo.zabbix.com/zabbix/3.0/rhel/7/x86_64/zabbix-release-3.0-1.el7.noarch.rpm</span><br><span class="line"></span><br><span class="line">#安装zabbix </span><br><span class="line">yum install -y zabbix-server-mysql zabbix-web-mysql</span><br><span class="line"></span><br><span class="line">#安装启动 mariadb数据库</span><br><span class="line">yum install -y  mariadb-server</span><br><span class="line">systemctl start mariadb.service</span><br><span class="line"></span><br><span class="line">#创建数据库</span><br><span class="line">mysql -e &apos;create database zabbix character set utf8 collate utf8_bin;&apos;</span><br><span class="line">mysql -e &apos;grant all privileges on zabbix.* to zabbix@localhost identified by &quot;zabbix&quot;;&apos;</span><br><span class="line"></span><br><span class="line">#导入数据</span><br><span class="line">zcat /usr/share/doc/zabbix-server-mysql-3.0.21/create.sql.gz|mysql -uzabbix -pzabbix zabbix</span><br><span class="line"></span><br><span class="line">#配置zabbixserver连接mysql</span><br><span class="line">sed -i.ori &apos;115a DBPassword=zabbix&apos; /etc/zabbix/zabbix_server.conf</span><br><span class="line"></span><br><span class="line">#添加时区</span><br><span class="line">sed -i.ori &apos;18a php_value date.timezone  Asia/Shanghai&apos; /etc/httpd/conf.d/zabbix.conf</span><br><span class="line"></span><br><span class="line">#解决中文乱码</span><br><span class="line">yum -y install wqy-microhei-fonts</span><br><span class="line">\cp /usr/share/fonts/wqy-microhei/wqy-microhei.ttc /usr/share/fonts/dejavu/DejaVuSans.ttf</span><br><span class="line"></span><br><span class="line">#启动服务</span><br><span class="line">systemctl start zabbix-server</span><br><span class="line"></span><br><span class="line">#修改/etc/httpd/conf/http.conf的监听端口为1234</span><br><span class="line">service httpd restart</span><br><span class="line"></span><br><span class="line"># 路由添加一条规则（192.168.177.1）</span><br><span class="line">iptables -t nat -A PREROUTING -d 192.168.0.177 -p tcp --dport 1234 -j DNAT --to 192.168.177.13</span><br><span class="line"># 此时windows访问192.168.0.177:1234/zabbix可以看到zabbix的setup界面</span><br><span class="line">&lt;!--[root@localhost ~]# cat for_hosts.sh --&gt;</span><br><span class="line">&lt;!--for i in &#123;3..14&#125;--&gt;</span><br><span class="line">&lt;!--do--&gt;</span><br><span class="line">&lt;!--	expect allow.sh 192.168.177.$&#123;i&#125;--&gt;</span><br><span class="line">&lt;!--done--&gt;</span><br><span class="line">&lt;!--[root@localhost ~]# cat allow.sh --&gt;</span><br><span class="line">&lt;!--set ip [lindex $argv 0]--&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--spawn ssh $ip--&gt;</span><br><span class="line">&lt;!--expect &quot;*password:&quot;--&gt;</span><br><span class="line">&lt;!--send &quot;123123\n&quot;--&gt;</span><br><span class="line">&lt;!--expect &quot;*#&quot;--&gt;</span><br><span class="line">&lt;!--send &quot;echo &apos;sshd:192.168.177.14&apos; &gt;&gt; /etc/hosts.allow\n&quot;--&gt;</span><br><span class="line">&lt;!--expect &quot;*#&quot;--&gt;</span><br><span class="line">&lt;!--send &quot;exit\n&quot;--&gt;</span><br><span class="line">&lt;!--expect eof--&gt;</span><br><span class="line">&lt;!--exit--&gt;</span><br><span class="line">&lt;!--# expect和send后的内容必须使用双引号，单引号报错！！！--&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 为了监听177网段所有主机，需要借助ansible（192.168.177.14）一步配置所有服务器</span><br><span class="line"># 编写部署zabbix-agent的脚本</span><br><span class="line">[root@localhost ~]# cat zabbix_client_set.sh </span><br><span class="line">#安装zabbix源、aliyu nYUM源</span><br><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">rpm -ivh http://repo.zabbix.com/zabbix/3.0/rhel/7/x86_64/zabbix-release-3.0-1.el7.noarch.rpm</span><br><span class="line"></span><br><span class="line">#安装zabbix客户端</span><br><span class="line">yum install zabbix-agent -y</span><br><span class="line">sed -i &apos;s/Server=127.0.0.1/Server=192.168.177.13/g&apos; /etc/zabbix/zabbix_agentd.conf</span><br><span class="line">systemctl start  zabbix-agent.service</span><br><span class="line"># 将这个脚本发送给各个机器</span><br><span class="line">[root@localhost ~]# cat cp_sh.sh </span><br><span class="line">for i in &#123;1..14&#125;</span><br><span class="line">do</span><br><span class="line">	scp /root/zabbix_client_set.sh 192.168.177.$&#123;i&#125;:/root</span><br><span class="line">done</span><br><span class="line"># ansible的playbook：</span><br><span class="line">[root@localhost ~]# cat zabbix_client_set.yaml </span><br><span class="line">- hosts: all</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">    - name: zabbix agent</span><br><span class="line">      shell: bash zabbix_client_set.sh</span><br><span class="line"></span><br><span class="line">ansible-playbook zabbox_client-set.yaml</span><br></pre></td></tr></table></figure>
</li>
<li><p>回到zabbix服务器，配置zabbix服务</p>
</li>
</ul>
<p>登录这里，用户名是Admin（大写A），密码为zabbix。<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://imglf6.nosdn0.126.net/img/c09lVS9TR3YrUFoyU01OdGZmc2E3N1J6R3ZRdkQ0NWFEQU00SjFrRjhFdUhVOHlHc2hDODdBPT0.png?imageView&thumbnail=500x0&quality=96&stripmeta=0" alt="zabbix_login" title="">
                </div>
                <div class="image-caption">zabbix_login</div>
            </figure></p>
<p>接着添加主机，为主机添加模板，那里不会点哪里…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--zabbix_server中agent配置文件的Server地址为127.0.0.1--&gt;</span><br><span class="line">&lt;!--看到状态和可用性亮绿灯即成功 --&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://imglf6.nosdn0.126.net/img/c09lVS9TR3YrUFoyU01OdGZmc2E3NnllTkNGTGtKTW9BWlRpWm83UXZNYlJYUFo4eVFhQklnPT0.png?imageView&thumbnail=500x0&quality=96&stripmeta=0" alt="zabbix_status" title="">
                </div>
                <div class="image-caption">zabbix_status</div>
            </figure>
        </div>

        <blockquote class="post-copyright">
    
    <footer>
        <a href="https://sevge.github.io/about">
            <img src="/img/avatar.jpg" alt="Sevge">
            Sevge
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            

            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://sevge.github.io/about/2018/09/11/linux-enterprise-cluster/&title=《高可用业务集群实验》 — Sevge's Blog&pic=https://sevge.github.io/about/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://sevge.github.io/about/2018/09/11/linux-enterprise-cluster/&title=《高可用业务集群实验》 — Sevge's Blog&source=My Blog" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://sevge.github.io/about/2018/09/11/linux-enterprise-cluster/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《高可用业务集群实验》 — Sevge's Blog&url=https://sevge.github.io/about/2018/09/11/linux-enterprise-cluster/&via=https://sevge.github.io/about" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://sevge.github.io/about/2018/09/11/linux-enterprise-cluster/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/08/29/lol/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">九月心情</h4>
      </a>
    </div>
  
</nav>



    

















</article>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Sevge &copy; 2017 - 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://sevge.github.io/about/2018/09/11/linux-enterprise-cluster/&title=《高可用业务集群实验》 — Sevge's Blog&pic=https://sevge.github.io/about/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://sevge.github.io/about/2018/09/11/linux-enterprise-cluster/&title=《高可用业务集群实验》 — Sevge's Blog&source=My Blog" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://sevge.github.io/about/2018/09/11/linux-enterprise-cluster/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《高可用业务集群实验》 — Sevge's Blog&url=https://sevge.github.io/about/2018/09/11/linux-enterprise-cluster/&via=https://sevge.github.io/about" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://sevge.github.io/about/2018/09/11/linux-enterprise-cluster/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACr0lEQVR42u3aQW7DMAwEwP7/0y3QU4Ei9q4oxS0wPgVO7Gh0EAmSHx/x9fl9/fz8886r+68+//797+t6DZsvPDw8vKWlX/9NQkrAyVPX21pvDR4eHt4x3iQYXP/mmnQdTvLfvLyPh4eH9ygvISXHd/JtvgY8PDy8/8K7Xuj1ET8pXuDh4eH9HV5yiCclg3kpoQ1I22oteHh4eF13qW6APfv5eH8PDw8Pb6mrnpcJ2nbXvJwRrRYPDw/vAK8tJewaxppsRxIFis4bHh4e3hKvbfMnr87HCNpiR9sqw8PDw9vLSw7lvOmVIxP8vBWHh4eHd4LXHvd5CJmXiefJOh4eHt45XovJB6TakJAXI+oNxcPDw9vKm7TBbo7jIHhEx3r5npsGGB4eHt6AlxzuiwNP5RBAwsu/xcPDwzvNy9PWtfJu21rbFZDw8PDwzvHyx9pUe9IAy0cWXt7Hw8PDe4g3GY2aDApM8Hh4eHjnePkftEWEeYI+KWTg4eHhvZ+XJMR5uXay9GQ7boINHh4e3lt4bWF3bQigbZXl6TUeHh7eOV5eqM2Xm5ck8qQ8T9bx8PDw3sPLm/Rr5dS8pDsf/8LDw8M7zcsBLWMtEZ8UiPHw8PDez2v/Zq2AO2+zLY5z4eHh4R3g5eFhcsRPAsDkzXh4eHi7eLuS3bb82rbN2i3Gw8PDeydv1xGfX/nAQf6GOv7g4eHhxbx8CCB/0a5kum3FRSvEw8PDG/M+y2tSls0b/5MycTQZgYeHhzfg7Up8J+Oqa+OteHh4eM/y5sFgrTQw2aAiwODh4eEd4+0tTOTpb/7sYhjDw8PDe5SXJ7LtQEBdb86Lv3h4eHh/gNe2r3L22sjCzVN4eHh4x3h5MSJZbt4kS8YL2qYaHh4e3mneWsm1TX/XMHUYmCwCDw8P7573BY5ZxTrKs1EVAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>








<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
